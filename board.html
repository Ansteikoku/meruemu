async function createThread() {

    log("▶ createThread START");

    const title   = document.getElementById("threadTitle").value.trim();
    const name    = document.getElementById("postName").value.trim() || "名無しさん";
    const content = document.getElementById("postContent").value.trim();
    const imageFile = document.getElementById("postImage").files[0];

    if (!title) {
        log("❌ スレタイが空");
        alert("スレタイを入力してください");
        return;
    }

    log("▶ threads insert 開始 board_id=" + boardId + " title=" + title);

    // ★★★ ここに詳細ログを追加 ★★★
    const { data: thread, error: errThread } = await sb
        .from("threads")
        .insert({
            board_id: boardId,
            title: title
        })
        .select();

    log("threads insert 完全ログ ↓↓↓");
    log(JSON.stringify({ thread, errThread }, null, 2));

    if (errThread) {
        log("❌ threads insert ERROR: " + errThread.message);
        alert("スレ作成エラー: " + errThread.message);
        return;
    }

    if (!thread || thread.length === 0) {
        log("❌ threads insert は成功したが返り値が空");
        alert("threads 返り値が空。RLSかポリシー設定を確認してください");
        return;
    }

    const threadId = thread[0].id;
    log("✔ threadId = " + threadId);

    // ---- 画像アップロード（省略発動） ----
    let imageUrl = null;

    if (imageFile) {
        const fileName = `thread_${threadId}_1_${Date.now()}.jpg`;

        log("▶ 画像アップロード開始: " + fileName);

        const { error: uploadErr } = await sb.storage
            .from("images")
            .upload(fileName, imageFile);

        log("upload 結果: " + JSON.stringify({ uploadErr }, null, 2));

        if (!uploadErr) {
            const { data: urlData } = sb.storage
                .from("images")
                .getPublicUrl(fileName);
            imageUrl = urlData.publicUrl;
            log("✔ publicUrl = " + imageUrl);
        }
    }

    // ---- posts に >>1 ----
    log("▶ posts insert 開始");

    const { error: errPost } = await sb.from("posts").insert({
        thread_id: threadId,
        name: name,
        content: content || "（本文なし）",
        image_url: imageUrl
    });

    log("posts 結果: " + JSON.stringify({ errPost }, null, 2));

    if (errPost) {
        log("❌ posts ERROR: " + errPost.message);
        alert("レス作成エラー: " + errPost.message);
        return;
    }

    log("✔ 完全成功 → thread.html へ移動");
    window.location.href = `thread.html?id=${threadId}`;
}
