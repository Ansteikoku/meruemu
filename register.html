<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>新規登録</title>
    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase.js"></script>
</head>
<body>

<div class="container">
    <h1 class="title">新規登録</h1>

    <div class="auth-box">

        <input id="username" class="auth-input" type="text"
            placeholder="ユーザー名（半角英数字）"><br><br>

        <input id="password" class="auth-input" type="password"
            placeholder="パスワード"><br><br>

        <button class="auth-btn" onclick="registerUser()">登録する</button><br><br>

        <a class="auth-link" href="login.html">→ ログインへ戻る</a>

    </div>
</div>

<script>
async function registerUser() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password) {
        alert("ユーザー名とパスワードを入力してください。");
        return;
    }

    // 同名ユーザーが存在しないか確認
    const { data: exist } = await sb
        .from("users")
        .select("*")
        .eq("username", username)
        .maybeSingle();

    if (exist) {
        alert("このユーザー名は既に使われています。");
        return;
    }

    // 新規登録
    const { error } = await sb
        .from("users")
        .insert({ username, password });

    if (error) {
        alert("エラー: " + error.message);
        return;
    }

    // ログイン扱いにする
    localStorage.setItem("username", username);

    // indexへ
    window.location.href = "index.html";
}
</script>

</body>
</html>
